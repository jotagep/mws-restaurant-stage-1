var dbPromise;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(t){fetch(DBHelper.DATABASE_URL).then(e=>{e.json().then(e=>(dbPromise.then(t=>{if(!t)return;const r=t.transaction("restaurants","readwrite").objectStore("restaurants");e.forEach(t=>{r.put(t)}),console.log("Added to IDB")}),t(null,e))).catch(e=>t(e,null))}).catch(e=>{dbPromise.then(e=>{if(!e)return;e.transaction("restaurants").objectStore("restaurants").getAll().then(function(e){return console.log("** From IDB **"),t(null,e)})}),console.error(e)})}static fetchRestaurantById(t,e){fetch(`${DBHelper.DATABASE_URL}/${t}`).then(t=>{t.json().then(t=>e(null,t)).catch(t=>e("Restaurant does not exist",null))}).catch(r=>{dbPromise.then(r=>{if(!r)return;r.transaction("restaurants").objectStore("restaurants").get(parseInt(t)).then(function(t){return console.log("** From IDB - ID **"),e(null,t)})}),console.error(r)})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((n,s)=>{if(n)r(n,null);else{let n=s;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),r(null,n)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`./assets/img/${t.photograph}`}static imageRespForRestaurant(t,e="original",r="jpg"){return"small"==e||"medium"==e?`./assets/img/${t.id}-${e}.${r} 1x,\n        ./assets/img/${t.id}-${e}@2x.${r} 2x`:`./assets/img/${t.id}-${e}.${r} 1x`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static openDB(){navigator.serviceWorker&&(console.log(" == IDB Created =="),dbPromise=idb.open("mws",1,function(t){t.createObjectStore("restaurants",{keyPath:"id"})}))}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbImRiUHJvbWlzZSIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwiY2FsbGJhY2siLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJyZXNwIiwiZGIiLCJzdG9yZSIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImUiLCJlcnJvciIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwiaWQiLCJnZXQiLCJwYXJzZUludCIsImN1aXNpbmUiLCJmZXRjaFJlc3RhdXJhbnRzIiwicmVzdWx0cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJwaG90b2dyYXBoIiwic2l6ZSIsImV4dCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiXSwibWFwcGluZ3MiOiJBQUdBLElBQUlBLGdCQUVFQyxTQU1GQywwQkFFSSxNQUFPLG9DQUdYQyx3QkFBd0JDLEdBQ3BCQyxNQUFNSixTQUFTQyxjQUNWSSxLQUFLQyxJQUNGQSxFQUFTQyxPQUNKRixLQUFLRyxJQUNGVCxVQUFVTSxLQUFNSSxJQUNaLElBQUtBLEVBQUksT0FFVCxNQUNNQyxFQURLRCxFQUFHRSxZQUFZLGNBQWUsYUFDeEJDLFlBQVksZUFFN0JKLEVBQUtLLFFBQVFDLElBQ1RKLEVBQU1LLElBQUlELEtBRWRFLFFBQVFDLElBQUksa0JBRVRkLEVBQVMsS0FBTUssS0FFekJVLE1BQU1DLEdBQUtoQixFQUFTZ0IsRUFBRyxTQUUvQkQsTUFBTUUsSUFDSHJCLFVBQVVNLEtBQUtJLElBQ1gsSUFBS0EsRUFBSSxPQUNLQSxFQUFHRSxZQUFZLGVBQ3hCQyxZQUFZLGVBRVhTLFNBQVNoQixLQUFLLFNBQVVpQixHQUUxQixPQURBTixRQUFRQyxJQUFJLGtCQUNMZCxFQUFTLEtBQU1tQixPQUc5Qk4sUUFBUUksTUFBTUEsS0FLMUJsQiwyQkFBMkJxQixFQUFJcEIsR0FFM0JDLFNBQVNKLFNBQVNDLGdCQUFnQnNCLEtBQzdCbEIsS0FBS0MsSUFDRkEsRUFBU0MsT0FDSkYsS0FBS0csR0FBUUwsRUFBUyxLQUFNSyxJQUM1QlUsTUFBTUMsR0FBS2hCLEVBQVMsNEJBQTZCLFNBRXpEZSxNQUFNRSxJQUNIckIsVUFBVU0sS0FBS0ksSUFDWCxJQUFLQSxFQUFJLE9BQ0tBLEVBQUdFLFlBQVksZUFDeEJDLFlBQVksZUFFWFksSUFBSUMsU0FBU0YsSUFBS2xCLEtBQUssU0FBVVMsR0FFbkMsT0FEQUUsUUFBUUMsSUFBSSx1QkFDTGQsRUFBUyxLQUFNVyxPQUc5QkUsUUFBUUksTUFBTUEsS0FRMUJsQixnQ0FBZ0N3QixFQUFTdkIsR0FFckNILFNBQVMyQixpQkFBaUIsQ0FBQ1AsRUFBT0UsS0FDOUIsR0FBSUYsRUFDQWpCLEVBQVNpQixFQUFPLFVBQ2IsQ0FFSCxNQUFNUSxFQUFVTixFQUFZTyxPQUFPQyxHQUFLQSxFQUFFQyxjQUFnQkwsR0FDMUR2QixFQUFTLEtBQU15QixNQVEzQjFCLHFDQUFxQzhCLEVBQWM3QixHQUUvQ0gsU0FBUzJCLGlCQUFpQixDQUFDUCxFQUFPRSxLQUM5QixHQUFJRixFQUNBakIsRUFBU2lCLEVBQU8sVUFDYixDQUVILE1BQU1RLEVBQVVOLEVBQVlPLE9BQU9DLEdBQUtBLEVBQUVFLGNBQWdCQSxHQUMxRDdCLEVBQVMsS0FBTXlCLE1BUTNCMUIsK0NBQStDd0IsRUFBU00sRUFBYzdCLEdBRWxFSCxTQUFTMkIsaUJBQWlCLENBQUNQLEVBQU9FLEtBQzlCLEdBQUlGLEVBQ0FqQixFQUFTaUIsRUFBTyxVQUNiLENBQ0gsSUFBSVEsRUFBVU4sRUFDQyxPQUFYSSxJQUNBRSxFQUFVQSxFQUFRQyxPQUFPQyxHQUFLQSxFQUFFQyxjQUFnQkwsSUFFaEMsT0FBaEJNLElBQ0FKLEVBQVVBLEVBQVFDLE9BQU9DLEdBQUtBLEVBQUVFLGNBQWdCQSxJQUVwRDdCLEVBQVMsS0FBTXlCLE1BUTNCMUIsMEJBQTBCQyxHQUV0QkgsU0FBUzJCLGlCQUFpQixDQUFDUCxFQUFPRSxLQUM5QixHQUFJRixFQUNBakIsRUFBU2lCLEVBQU8sVUFDYixDQUVILE1BQU1hLEVBQWdCWCxFQUFZWSxJQUFJLENBQUNDLEVBQUdDLElBQU1kLEVBQVljLEdBQUdKLGNBRXpESyxFQUFzQkosRUFBY0osT0FBTyxDQUFDTSxFQUFHQyxJQUFNSCxFQUFjSyxRQUFRSCxJQUFNQyxHQUN2RmpDLEVBQVMsS0FBTWtDLE1BUTNCbkMscUJBQXFCQyxHQUVqQkgsU0FBUzJCLGlCQUFpQixDQUFDUCxFQUFPRSxLQUM5QixHQUFJRixFQUNBakIsRUFBU2lCLEVBQU8sVUFDYixDQUVILE1BQU1tQixFQUFXakIsRUFBWVksSUFBSSxDQUFDQyxFQUFHQyxJQUFNZCxFQUFZYyxHQUFHTCxjQUVwRFMsRUFBaUJELEVBQVNWLE9BQU8sQ0FBQ00sRUFBR0MsSUFBTUcsRUFBU0QsUUFBUUgsSUFBTUMsR0FDeEVqQyxFQUFTLEtBQU1xQyxNQVEzQnRDLHdCQUF3QlksR0FDcEIsOEJBQWdDQSxFQUFXUyxLQU0vQ3JCLDZCQUE2QlksR0FDekIsc0JBQXdCQSxFQUFXMkIsYUFNdkN2Qyw4QkFBOEJZLEVBQVk0QixFQUFPLFdBQVlDLEVBQU0sT0FDL0QsTUFBWSxTQUFSRCxHQUEyQixVQUFSQSxrQkFDSzVCLEVBQVdTLE1BQU1tQixLQUFRQywrQkFDdEM3QixFQUFXUyxNQUFNbUIsUUFBV0MsdUJBRWY3QixFQUFXUyxNQUFNbUIsS0FBUUMsT0FPekR6Qyw4QkFBOEJZLEVBQVlvQixHQVF0QyxPQVBlLElBQUlVLE9BQU9DLEtBQUtDLFFBQzNCQyxTQUFVakMsRUFBV2tDLE9BQ3JCQyxNQUFPbkMsRUFBV29DLEtBQ2xCQyxJQUFLbkQsU0FBU29ELGlCQUFpQnRDLEdBQy9Cb0IsSUFBS0EsRUFDTG1CLFVBQVdULE9BQU9DLEtBQUtTLFVBQVVDLE9BS3pDckQsZ0JBQ1NzRCxVQUFVQyxnQkFHZnpDLFFBQVFDLElBQUksc0JBQ1psQixVQUFZMkQsSUFBSUMsS0FBSyxNQUFPLEVBQUcsU0FBVUMsR0FDdkJBLEVBQVVDLGtCQUFrQixlQUN0Q0MsUUFBUyIsImZpbGUiOiJkYmhlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4gKi9cbnZhciBkYlByb21pc2U7XG5cbmNsYXNzIERCSGVscGVyIHtcblxuICAgIC8qKlxuICAgICAqIERhdGFiYXNlIFVSTC5cbiAgICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAgICovXG4gICAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgICAgIGNvbnN0IHBvcnQgPSAnMTMzNyc7XG4gICAgICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuICAgICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3AgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGJQcm9taXNlLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3AuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRlZCB0byBJREInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgcmVzcClcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gY2FsbGJhY2soZSwgbnVsbCkpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLmdldEFsbCgpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnKiogRnJvbSBJREIgKionKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9LyR7aWR9YClcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5qc29uKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcCA9PiBjYWxsYmFjayhudWxsLCByZXNwKSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLmdldChwYXJzZUludChpZCkpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcqKiBGcm9tIElEQiAtIElEICoqJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG4gICAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xuICAgICAgICAgICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuICAgIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcbiAgICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuICAgIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgICAqL1xuICAgIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgICAqL1xuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgICByZXR1cm4gKGAuL2Fzc2V0cy9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzdGF1cmFudCByZXNwb25zaXZlIGltYWdlIFVSTC5cbiAgICAgKi9cbiAgICBzdGF0aWMgaW1hZ2VSZXNwRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzaXplID0gJ29yaWdpbmFsJywgZXh0ID0gJ2pwZycpIHtcbiAgICAgICAgaWYgKHNpemUgPT0gJ3NtYWxsJyB8fCBzaXplID09ICdtZWRpdW0nKSB7XG4gICAgICAgICAgICByZXR1cm4gKGAuL2Fzc2V0cy9pbWcvJHtyZXN0YXVyYW50LmlkfS0ke3NpemV9LiR7ZXh0fSAxeCxcbiAgICAgICAgLi9hc3NldHMvaW1nLyR7cmVzdGF1cmFudC5pZH0tJHtzaXplfUAyeC4ke2V4dH0gMnhgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoYC4vYXNzZXRzL2ltZy8ke3Jlc3RhdXJhbnQuaWR9LSR7c2l6ZX0uJHtleHR9IDF4YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAgICovXG4gICAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcbiAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICB9XG5cbiAgICBzdGF0aWMgb3BlbkRCKCkge1xuICAgICAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJyA9PSBJREIgQ3JlYXRlZCA9PScpO1xuICAgICAgICBkYlByb21pc2UgPSBpZGIub3BlbignbXdzJywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEQikge1xuICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0iXX0=
